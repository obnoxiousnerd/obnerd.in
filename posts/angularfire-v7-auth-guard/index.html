<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="Pranav Karawale&#39;s various things in writing."/>

<link rel="canonical" href="https://karawale.in/posts/angularfire-v7-auth-guard/"/>

<link rel="me" href="https://github.com/retronav"/>
<link rel="me" href="https://fosstodon.org/@retronav"/>


    <link rel="webmention" href="https://webmention.io/karawale.in/webmention"/>



    <link rel="pingback" href="https://webmention.io/karawale.in/xmlrpc"/>

        <link rel="preload" as="font" type="font/woff2" href="/fonts/cabin-latin-variable-wghtOnly-normal.woff2" crossorigin="anonymous">
        <link rel="preload" as="font" type="font/woff2" href="/fonts/iosevka-minimal.woff2" crossorigin="anonymous"><meta name="generator" content="Eleventy v2.0.0"/>

<link rel="shortcut icon" href="/favicon.png" type="image/png">
<link rel="stylesheet" href="/main.css"/>
<title>
    
        Angularfire V7 Auth Guard - Pranav Karawale
    
</title>

  </head>
  <body>
    
<header>
    <img src="/logo96.webp" height="48" width="48" 
        alt="My logo; The letters 'pk' in a white, bold font on a purplish background.">
    <br/>
    <div class="h-card">
        <a class="u-url p-name" href="/">Pranav Karawale</a>
    </div>
    <hr />
    <nav>
        <ul>
        
            <li>
                <a 
                    href="/about"
                    
                >About</a>
            </li>
        
            <li>
                <a 
                    href="/projects"
                    
                >Projects</a>
            </li>
        
            <li>
                <a 
                    href="/posts"
                    
                >Blog</a>
            </li>
        
            <li>
                <a 
                    href="/more-links"
                    aria-label="More links"
                >More</a>
            </li>
        
        </ul>
    </nav>
</header>
<hr>
<main>
  
<article class="h-entry">
  <header>
    <h1 class="p-name" class="title">Angularfire V7 Auth Guard</h1>
    <time class="dt-published" datetime="2021-06-08T00:00:00Z">
      08 June 2021
    </time>
    
    <span class="seperator">&centerdot;</span>
    <span>By</span><div class="h-card h-card-mini p-author">
    <img class="u-photo" width="24" height="24" src="/img/me96.webp" alt="A close-up photo of my face.">
    <a href="/" rel="author" class="p-name u-url">
        Pranav Karawale
    </a>
</div>
    <br>
    
      <span>Tagged under: </span>
    
    
      
    
      
        <a class="p-category" href="/tags/snippets">snippets</a>
      
    
  </header>
  <aside>
    <details class="toc">
      <summary>Table of Contents</summary>
      
    </details>
  </aside>
  <hr/>
  <div class="e-content">
    <p>As of now, the AngularFire v7(<strong>"Beta"</strong>) does not have an implementation for an
auth guard(which I really need), so I went ahead, copied the original auth guard
code (from v6), and refactored it to make it compatible with v7.</p>
<p><strong>This code works on Angular 12. I haven't tested it for older versions, but it should work.</strong></p>
<p>Here's the code:</p>
<pre class="shiki" style="background-color: #1d2021"><code><span class="line"><span style="color: #FB4934">import</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">Injectable</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">}</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">from</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">'</span><span style="color: #B8BB26">@angular/core</span><span style="color: #A89984">'</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">import</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">Auth</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">}</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">from</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">'</span><span style="color: #B8BB26">@angular/fire</span><span style="color: #A89984">'</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">import</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">authState</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">}</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">from</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">'</span><span style="color: #B8BB26">@angular/fire/auth</span><span style="color: #A89984">'</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">import</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #83A598">ActivatedRouteSnapshot</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #83A598">CanActivate</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #83A598">Router</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #83A598">RouterStateSnapshot</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #83A598">UrlTree</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #A89984">}</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">from</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">'</span><span style="color: #B8BB26">@angular/router</span><span style="color: #A89984">'</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">import</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">User</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">}</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">from</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">'</span><span style="color: #B8BB26">@firebase/auth</span><span style="color: #A89984">'</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">import</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">Observable</span><span style="color: #A89984">,</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">of</span><span style="color: #A89984">,</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">pipe</span><span style="color: #A89984">,</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">UnaryFunction</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">}</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">from</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">'</span><span style="color: #B8BB26">rxjs</span><span style="color: #A89984">'</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">import</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">map</span><span style="color: #A89984">,</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">switchMap</span><span style="color: #A89984">,</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">take</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">}</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">from</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">'</span><span style="color: #B8BB26">rxjs/operators</span><span style="color: #A89984">'</span><span style="color: #A89984">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">type</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">AuthPipeGenerator</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=</span><span style="color: #EBDBB2"> (</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #83A598">next</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> ActivatedRouteSnapshot</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #83A598">state</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> RouterStateSnapshot</span></span>
<span class="line"><span style="color: #EBDBB2">) </span><span style="color: #8EC07C">=></span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">AuthPipe</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">type</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">AuthPipe</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">UnaryFunction</span><span style="color: #A89984">&#x3C;</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #FABD2F">Observable</span><span style="color: #A89984">&#x3C;</span><span style="color: #FABD2F">User</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">|</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">null</span><span style="color: #A89984">>,</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #FABD2F">Observable</span><span style="color: #A89984">&#x3C;</span><span style="color: #FABD2F">boolean</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">|</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">string</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">|</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">any</span><span style="color: #EBDBB2">[]</span><span style="color: #A89984">></span></span>
<span class="line"><span style="color: #A89984">>;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">const</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">loggedIn</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> AuthPipe </span><span style="color: #8EC07C">=</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">map</span><span style="color: #EBDBB2">(</span><span style="color: #A89984">(</span><span style="color: #83A598">user</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">!!</span><span style="color: #83A598">user</span><span style="color: #EBDBB2">)</span><span style="color: #A89984">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #928374; font-style: italic">/**</span></span>
<span class="line"><span style="color: #928374; font-style: italic"> * Auth guard based on AngularFire v6 AngularFireAuthGuard.</span></span>
<span class="line"><span style="color: #928374; font-style: italic"> * Check out the v6 implementation here: https://git.io/JZOcy</span></span>
<span class="line"><span style="color: #928374; font-style: italic"> */</span></span>
<span class="line"><span style="color: #A89984">@</span><span style="color: #FABD2F">Injectable</span><span style="color: #EBDBB2">(</span><span style="color: #A89984">{</span></span>
<span class="line"><span style="color: #EBDBB2">  providedIn</span><span style="color: #A89984">:</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">'</span><span style="color: #B8BB26">root</span><span style="color: #A89984">'</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #A89984">}</span><span style="color: #EBDBB2">)</span></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">class</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">AuthGuard</span><span style="color: #EBDBB2"> </span><span style="color: #FE8019">implements</span><span style="color: #EBDBB2"> CanActivate </span><span style="color: #A89984">{</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #FB4934">constructor</span><span style="color: #A89984">(</span><span style="color: #FE8019">private</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">auth</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> Auth</span><span style="color: #A89984">,</span><span style="color: #EBDBB2"> </span><span style="color: #FE8019">private</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">router</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> Router</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{}</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #FABD2F">canActivate</span><span style="color: #A89984">(</span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #83A598">route</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> ActivatedRouteSnapshot</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #83A598">state</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> RouterStateSnapshot</span></span>
<span class="line"><span style="color: #FABD2F">  </span><span style="color: #A89984">)</span><span style="color: #8EC07C">:</span></span>
<span class="line"><span style="color: #FABD2F">    </span><span style="color: #8EC07C">|</span><span style="color: #FABD2F"> Observable</span><span style="color: #A89984">&#x3C;</span><span style="color: #FABD2F">boolean </span><span style="color: #8EC07C">|</span><span style="color: #FABD2F"> UrlTree</span><span style="color: #A89984">></span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #8EC07C">|</span><span style="color: #EBDBB2"> Promise</span><span style="color: #8EC07C">&#x3C;</span><span style="color: #83A598">boolean</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">|</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">UrlTree</span><span style="color: #8EC07C">></span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #8EC07C">|</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">boolean</span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #8EC07C">|</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">UrlTree</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{</span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #FB4934">const</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">authPipeFactory</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=</span></span>
<span class="line"><span style="color: #EBDBB2">      (</span><span style="color: #83A598">route</span><span style="color: #A89984">.</span><span style="color: #83A598">data</span><span style="color: #A89984">.</span><span style="color: #83A598">authGuardPipe</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">as</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">AuthPipeGenerator</span><span style="color: #EBDBB2">) </span><span style="color: #FB4934">||</span><span style="color: #EBDBB2"> (</span><span style="color: #A89984">()</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span><span style="color: #EBDBB2"> </span><span style="color: #83A598">loggedIn</span><span style="color: #EBDBB2">)</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #FB4934">return</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">authState</span><span style="color: #EBDBB2">(</span><span style="color: #FE8019">this</span><span style="color: #A89984">.</span><span style="color: #83A598">auth</span><span style="color: #EBDBB2">)</span><span style="color: #A89984">.</span><span style="color: #FABD2F">pipe</span><span style="color: #EBDBB2">(</span></span>
<span class="line"><span style="color: #EBDBB2">      </span><span style="color: #FABD2F">take</span><span style="color: #EBDBB2">(</span><span style="color: #D3869B">1</span><span style="color: #EBDBB2">)</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">      </span><span style="color: #FABD2F">authPipeFactory</span><span style="color: #EBDBB2">(</span><span style="color: #83A598">route</span><span style="color: #A89984">,</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">state</span><span style="color: #EBDBB2">)</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">      </span><span style="color: #FABD2F">map</span><span style="color: #EBDBB2">(</span><span style="color: #A89984">(</span><span style="color: #83A598">can</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{</span></span>
<span class="line"><span style="color: #EBDBB2">        </span><span style="color: #FB4934">if</span><span style="color: #EBDBB2"> (</span><span style="color: #8EC07C">typeof</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">can</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">===</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">'</span><span style="color: #B8BB26">boolean</span><span style="color: #A89984">'</span><span style="color: #EBDBB2">) </span><span style="color: #A89984">{</span></span>
<span class="line"><span style="color: #EBDBB2">          </span><span style="color: #FB4934">return</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">can</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #EBDBB2">        </span><span style="color: #A89984">}</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">else</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">if</span><span style="color: #EBDBB2"> (Array</span><span style="color: #A89984">.</span><span style="color: #FABD2F">isArray</span><span style="color: #EBDBB2">(</span><span style="color: #83A598">can</span><span style="color: #EBDBB2">)) </span><span style="color: #A89984">{</span></span>
<span class="line"><span style="color: #EBDBB2">          </span><span style="color: #FB4934">return</span><span style="color: #EBDBB2"> </span><span style="color: #FE8019">this</span><span style="color: #A89984">.</span><span style="color: #83A598">router</span><span style="color: #A89984">.</span><span style="color: #FABD2F">createUrlTree</span><span style="color: #EBDBB2">(</span><span style="color: #83A598">can</span><span style="color: #EBDBB2">)</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #EBDBB2">        </span><span style="color: #A89984">}</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">else</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{</span></span>
<span class="line"><span style="color: #EBDBB2">          </span><span style="color: #FB4934">return</span><span style="color: #EBDBB2"> </span><span style="color: #FE8019">this</span><span style="color: #A89984">.</span><span style="color: #83A598">router</span><span style="color: #A89984">.</span><span style="color: #FABD2F">parseUrl</span><span style="color: #EBDBB2">(</span><span style="color: #83A598">can</span><span style="color: #EBDBB2">)</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #EBDBB2">        </span><span style="color: #A89984">}</span></span>
<span class="line"><span style="color: #EBDBB2">      </span><span style="color: #A89984">}</span><span style="color: #EBDBB2">)</span></span>
<span class="line"><span style="color: #EBDBB2">    )</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #A89984">}</span></span>
<span class="line"><span style="color: #A89984">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">const</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">canActivate</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">(</span><span style="color: #83A598">pipe</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> AuthPipeGenerator</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span><span style="color: #EBDBB2"> (</span><span style="color: #A89984">{</span></span>
<span class="line"><span style="color: #EBDBB2">  canActivate</span><span style="color: #A89984">:</span><span style="color: #EBDBB2"> [</span><span style="color: #83A598">AuthGuard</span><span style="color: #EBDBB2">]</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">  data</span><span style="color: #A89984">:</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">{</span><span style="color: #EBDBB2"> authGuardPipe</span><span style="color: #A89984">:</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">pipe</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">},</span></span>
<span class="line"><span style="color: #A89984">}</span><span style="color: #EBDBB2">)</span><span style="color: #A89984">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">const</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">isNotAnonymous</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> AuthPipe </span><span style="color: #8EC07C">=</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">map</span><span style="color: #EBDBB2">(</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #A89984">(</span><span style="color: #83A598">user</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">!!</span><span style="color: #83A598">user</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">&#x26;&#x26;</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">!</span><span style="color: #83A598">user</span><span style="color: #A89984">.</span><span style="color: #83A598">isAnonymous</span></span>
<span class="line"><span style="color: #EBDBB2">)</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">const</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">idTokenResult</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">switchMap</span><span style="color: #EBDBB2">(</span><span style="color: #A89984">(</span><span style="color: #83A598">user</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> User </span><span style="color: #8EC07C">|</span><span style="color: #FABD2F"> null</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #83A598">user</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">?</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">user</span><span style="color: #A89984">.</span><span style="color: #FABD2F">getIdTokenResult</span><span style="color: #EBDBB2">() </span><span style="color: #8EC07C">:</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">of</span><span style="color: #EBDBB2">(</span><span style="color: #D3869B">null</span><span style="color: #EBDBB2">)</span></span>
<span class="line"><span style="color: #EBDBB2">)</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">const</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">emailVerified</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> AuthPipe </span><span style="color: #8EC07C">=</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">map</span><span style="color: #EBDBB2">(</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #A89984">(</span><span style="color: #83A598">user</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">!!</span><span style="color: #83A598">user</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">&#x26;&#x26;</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">user</span><span style="color: #A89984">.</span><span style="color: #83A598">emailVerified</span></span>
<span class="line"><span style="color: #EBDBB2">)</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">const</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">customClaims</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">pipe</span><span style="color: #EBDBB2">(</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #83A598">idTokenResult</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #FABD2F">map</span><span style="color: #EBDBB2">(</span><span style="color: #A89984">(</span><span style="color: #83A598">idTokenResult</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span><span style="color: #EBDBB2"> (</span><span style="color: #83A598">idTokenResult</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">?</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">idTokenResult</span><span style="color: #A89984">.</span><span style="color: #83A598">claims</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">:</span><span style="color: #EBDBB2"> []))</span></span>
<span class="line"><span style="color: #EBDBB2">)</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">const</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">hasCustomClaim</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> </span><span style="color: #A89984">(</span><span style="color: #83A598">claim</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> string</span><span style="color: #A89984">)</span><span style="color: #FABD2F"> </span><span style="color: #8EC07C">=></span><span style="color: #FABD2F"> AuthPipe </span><span style="color: #8EC07C">=</span><span style="color: #EBDBB2"> </span><span style="color: #A89984">(</span><span style="color: #83A598">claim</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #FABD2F">pipe</span><span style="color: #EBDBB2">(</span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #83A598">customClaims</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #FABD2F">map</span><span style="color: #EBDBB2">(</span><span style="color: #A89984">(</span><span style="color: #83A598">claims</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span><span style="color: #EBDBB2"> </span><span style="color: #83A598">claims</span><span style="color: #A89984">.</span><span style="color: #FABD2F">hasOwnProperty</span><span style="color: #EBDBB2">(</span><span style="color: #83A598">claim</span><span style="color: #EBDBB2">))</span></span>
<span class="line"><span style="color: #EBDBB2">  )</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">const</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">redirectUnauthorizedTo</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> </span><span style="color: #A89984">(</span><span style="color: #83A598">redirect</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> string </span><span style="color: #8EC07C">|</span><span style="color: #FABD2F"> any[]</span><span style="color: #A89984">)</span><span style="color: #FABD2F"> </span><span style="color: #8EC07C">=></span><span style="color: #FABD2F"> AuthPipe </span><span style="color: #8EC07C">=</span><span style="color: #EBDBB2"> (</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #83A598">redirect</span></span>
<span class="line"><span style="color: #EBDBB2">) </span><span style="color: #8EC07C">=></span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #FABD2F">pipe</span><span style="color: #EBDBB2">(</span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #83A598">loggedIn</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #FABD2F">map</span><span style="color: #EBDBB2">(</span><span style="color: #A89984">(</span><span style="color: #83A598">loggedIn</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span><span style="color: #EBDBB2"> </span><span style="color: #83A598">loggedIn</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">||</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">redirect</span><span style="color: #EBDBB2">)</span></span>
<span class="line"><span style="color: #EBDBB2">  )</span><span style="color: #A89984">;</span></span>
<span class="line"><span style="color: #FB4934">export</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">const</span><span style="color: #EBDBB2"> </span><span style="color: #FABD2F">redirectLoggedInTo</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> </span><span style="color: #A89984">(</span><span style="color: #83A598">redirect</span><span style="color: #8EC07C">:</span><span style="color: #FABD2F"> string </span><span style="color: #8EC07C">|</span><span style="color: #FABD2F"> any[]</span><span style="color: #A89984">)</span><span style="color: #FABD2F"> </span><span style="color: #8EC07C">=></span><span style="color: #FABD2F"> AuthPipe </span><span style="color: #8EC07C">=</span><span style="color: #EBDBB2"> (</span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #83A598">redirect</span></span>
<span class="line"><span style="color: #EBDBB2">) </span><span style="color: #8EC07C">=></span></span>
<span class="line"><span style="color: #EBDBB2">  </span><span style="color: #FABD2F">pipe</span><span style="color: #EBDBB2">(</span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #83A598">loggedIn</span><span style="color: #A89984">,</span></span>
<span class="line"><span style="color: #EBDBB2">    </span><span style="color: #FABD2F">map</span><span style="color: #EBDBB2">(</span><span style="color: #A89984">(</span><span style="color: #83A598">loggedIn</span><span style="color: #A89984">)</span><span style="color: #EBDBB2"> </span><span style="color: #8EC07C">=></span><span style="color: #EBDBB2"> (</span><span style="color: #83A598">loggedIn</span><span style="color: #EBDBB2"> </span><span style="color: #FB4934">&#x26;&#x26;</span><span style="color: #EBDBB2"> </span><span style="color: #83A598">redirect</span><span style="color: #EBDBB2">) </span><span style="color: #FB4934">||</span><span style="color: #EBDBB2"> </span><span style="color: #D3869B">true</span><span style="color: #EBDBB2">)</span></span>
<span class="line"><span style="color: #EBDBB2">  )</span><span style="color: #A89984">;</span></span>
<span class="line"></span></code></pre>
  </div>
</article>
<hr />
<section class="comments">
    <h2>Comments</h2>
    <section class="webmention webmention-reactions">
        <p>
            My website supports 
            <a href="https://en.wikipedia.org/wiki/Webmention">webmentions</a>.
            This means that if you like, repost, or reply to this page via
            Mastodon, Twitter, etc. they will show up here.
            <br>
            Or if you want to, you can e-mail your thoughts about it on 
            <code>pranav [at] karawale.in</code>.
        </p>
        <form 
            class="send-webmention" action="https://webmention.io/karawale.in/webmention" 
            method="post"
            aria-label="Send a webmention to this page">
            <label for="webmention-form-input">
                URL of your webmention
            </label>
            <input 
                id="webmention-form-input"
                name="source" type="url" 
                required placeholder="https://example.com/">
            <input 
                type="text"
                name="target"
                hidden value="https://karawale.in/posts/angularfire-v7-auth-guard/"
            >
            <input type="submit" value="Send webmention">
        </form>
        <details aria-label="Likes and reposts of this page">
            <summary>
                Likes and reposts
            </summary>
            <ul class="webmention-reactions" aria-label="Likes and reposts of this page">
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
</ul>
        </details>
        <h3>Replies</h3>
        <ul class="webmention-reactions">
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
</ul>
    </section>
    <section class="webmention-replies" aria-label="Replies to this page">
    </section>
</section>
</main>
<hr>
<footer>
  <p class="license">
    <small>
      All content licensed under 
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
        CC BY-NC-SA 4.0
      </a>
      , unless stated otherwise.
    </small>
  </p>
</footer>
  </body>
</html>