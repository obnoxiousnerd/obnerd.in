<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="This little experiment gives variables &#39;superpowers&#39; to be able to reflect their changes directly into the DOM."/>

<link rel="me" href="https://github.com/retronav"/>
<link rel="me" href="https://tilde.zone/@pranav"/>


    <link rel="webmention" href="https://webmention.io/karawale.in/webmention"/>



    <link rel="pingback" href="https://webmention.io/karawale.in/xmlrpc"/>

        <link rel="preload" as="font" type="font/woff2" href="/roboto-slab-latin-variable-wghtOnly-normal.woff2" crossorigin="anonymous">
        <link rel="preload" as="font" type="font/woff2" href="/victor-mono-latin.woff2" crossorigin="anonymous"><link rel="shortcut icon" href="/favicon.png" type="image/png">
<link rel="stylesheet" href="/main.css"/>
<title>
    
        Reactivity Anywhere Without Virtual Dom - Pranav Karawale
    
</title>
  </head>
  <body>
    
<header>
    <img src="/logo96.webp" height="48" width="48" alt="">
    <br/>
    <div class="h-card">
        <a class="u-url p-name" href="/">Pranav Karawale</a>
    </div>
</header>
<hr>
<main>
  <article class="h-entry">
  <header>
    <h1 class="p-name" class="title">Reactivity Anywhere Without Virtual Dom</h1>
    <time class="dt-published" datetime="2020-11-20T00:00:00Z">
      20/11/2020
    </time>
    <span class="seperator">&centerdot;</span>
    <span>By</span><div class="h-card h-card-mini p-author">
    <img class="u-photo" width="24" height="24" src="/img/me96.webp" alt="A close-up photo of my face.">
    <a href="/" rel="author" class="p-name u-url">
        Pranav Karawale
    </a>
</div>
  </header>
  <aside>
    <nav class="toc" >
        <ul><li><a href="#how-did-this-got-into-my-mind">How did this got into my mind??</a></li><li><a href="#disclaimer">Disclaimer</a></li><li><a href="#lets-start">Let's Start!!</a><ul><li><a href="#prerequisites">Prerequisites</a></li></ul></li><li><a href="#defining-the-global-variablesprecisely-stores">Defining the global variables(precisely, stores)</a><ul><li><a href="#but-this-seems-like-virtual-dom">But this seems like virtual DOM!!!</a></li></ul></li><li><a href="#determining-reactive-elements">Determining reactive elements</a></li><li><a href="#the-refs">The __refs__</a></li><li><a href="#the-reactives">The __reactives__</a></li><li><a href="#the-reactive">The reactive()</a></li><li><a href="#the-updatedom">The __updateDOM__()</a></li><li><a href="#finding-all-the-reactive-variables-and-bootstrapping-them">Finding all the reactive variables and bootstrapping them</a></li><li><a href="#making-input-and-textarea-work-with-reactives">Making &lt;input&gt; and &lt;textarea&gt; work with reactives</a></li><li><a href="#were-almost-done">We're almost done!</a></li><li><a href="#why-something-like-this-would-be-great-to-use-according-to-me">Why something like this would be great to use (according to me)</a></li><li><a href="#limitations">Limitations</a></li><li><a href="#ending-notes">Ending notes</a></li></ul>
      </nav>
  </aside>
  <hr/>
  <div class="e-content">
    <h1 id="how-did-this-got-into-my-mind" tabindex="-1">How did this got into my mind??</h1>
<p>Virtual DOM can be referenced as the thing which just &quot;introduced&quot; me to the title of this post. What if we keep aside all that diffing, state stuff, and focus on one thing: reactivity between the JavaScript and the DOM. Well, most of us are using libraries just to achieve this reactivity in our apps. But most of them implement a virtual DOM which keeps track of all the tags, states, variables, objects, and whatnot and then syncs them with the real DOM. As said, things might get a little crazy doing all this stuff. So I just decided, why not just implement a crude example of all this &quot;virtual DOM&quot; thing without virtual DOM. Is this even achievable?? The answer is (0.5 * yes)!! For the sake of this post, let us call it &quot;Reactivity Anywhere.&quot;</p>
<h1 id="disclaimer" tabindex="-1">Disclaimer</h1>
<p>This post might have things that seem vague and senseless. Also don't take things too seriously here, take them as just a thought. Reader discretion is advised.</p>
<h1 id="lets-start" tabindex="-1">Let's Start!!</h1>
<h2 id="prerequisites" tabindex="-1">Prerequisites</h2>
<ul>
<li>A web browser</li>
<li>JavaScript</li>
</ul>
<h1 id="defining-the-global-variablesprecisely-stores" tabindex="-1">Defining the global variables(precisely, stores)</h1>
<p>To keep track of what goes here and there, we need some global variables to preserve and mutate all the states.</p>
<pre class="shiki" style="background-color: #0b0e14"><code><span class="line"><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> __refs__ </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> {}</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> __reactives__ </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> []</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> __reactiveEl__ </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> document</span><span style="color: #F29668">.</span><span style="color: #FFB454">querySelectorAll</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;[reactive]&quot;</span><span style="color: #BFBDB6">)</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> </span><span style="color: #FFB454">reactive</span><span style="color: #BFBDB6"> </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> (</span><span style="color: #D2A6FF">obj</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #ACB6BF8C; font-style: italic">/*Add logic*/</span></span>
<span class="line"><span style="color: #BFBDB6">}</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> </span><span style="color: #FFB454">__updateDOM__</span><span style="color: #BFBDB6"> </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> (</span><span style="color: #D2A6FF">ref</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #ACB6BF8C; font-style: italic">/*Add logic*/</span></span>
<span class="line"><span style="color: #BFBDB6">}</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"></span></code></pre>
<p>This is just everything we need for the logic. The variables whose names start and end with double underscores are <a href="https://github.com/facebook/react/blob/3ebf05183dfcb8eadfc41a9e19559d835fd9b77e/packages/react/index.js#L71">internals</a>.
We will only store two things: references to the elements, and, of course, the reactive variables.</p>
<h2 id="but-this-seems-like-virtual-dom" tabindex="-1">But this seems like virtual DOM!!!</h2>
<p>But I'm sorry, this is not the virtual DOM you think:</p>
<ul>
<li>We will not be diffing the whole element tree for every single change; only and only the affected element will be mutated (less carbon dioxide)</li>
</ul>
<h1 id="determining-reactive-elements" tabindex="-1">Determining <code>reactive</code> elements</h1>
<p>To keep specificity and refrain from scanning the whole DOM, we will just handpick special elements that work with our module. So, any element that has the <code>reactive</code> attribute (<code>&lt;element reactive&gt;&lt;/element&gt;</code>), will only be able to use the special reactive powers.</p>
<p>To access the reactive elements from the store, we will use the ES6 string interpolation syntax. So, to access the <code>count</code>, we will write</p>
<pre class="shiki" style="background-color: #0b0e14"><code><span class="line"><span style="color: #39BAE680">&lt;</span><span style="color: #39BAE6">h1</span><span style="color: #BFBDB6"> </span><span style="color: #FFB454">reactive</span><span style="color: #39BAE680">&gt;</span><span style="color: #BFBDB6">The time is ${count}</span><span style="color: #39BAE680">&lt;/</span><span style="color: #39BAE6">h1</span><span style="color: #39BAE680">&gt;</span></span>
<span class="line"></span></code></pre>
<h1 id="the-refs" tabindex="-1">The <code>__refs__</code></h1>
<p>Here, we will store the values of the object passed in the <code>reactive</code> function.</p>
<h1 id="the-reactives" tabindex="-1">The <code>__reactives__</code></h1>
<p>This is just an array containing live references of the DOM Elements.</p>
<h1 id="the-reactive" tabindex="-1">The <code>reactive()</code></h1>
<p>This function is basically a store where you'd be storing all the reactive stuff.
The definition of the function is surprisingly simple:</p>
<pre class="shiki" style="background-color: #0b0e14"><code><span class="line"><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> </span><span style="color: #FFB454">reactive</span><span style="color: #BFBDB6"> </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> (</span><span style="color: #D2A6FF">obj</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #ACB6BF8C; font-style: italic">//Loop through the string</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #39BAE6">Object</span><span style="color: #F29668">.</span><span style="color: #FFB454">keys</span><span style="color: #BFBDB6">(obj)</span><span style="color: #F29668">.</span><span style="color: #FFB454">forEach</span><span style="color: #BFBDB6">((</span><span style="color: #D2A6FF">key</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">    </span><span style="color: #ACB6BF8C; font-style: italic">// defineProperty, anyone??</span></span>
<span class="line"><span style="color: #BFBDB6">    </span><span style="color: #ACB6BF8C; font-style: italic">// We want to maintain reactivity, so we are using custom</span></span>
<span class="line"><span style="color: #BFBDB6">    </span><span style="color: #ACB6BF8C; font-style: italic">// getters and setters</span></span>
<span class="line"><span style="color: #BFBDB6">    </span><span style="color: #39BAE6">Object</span><span style="color: #F29668">.</span><span style="color: #FFB454">defineProperty</span><span style="color: #BFBDB6">(__refs__</span><span style="color: #BFBDB6B3">,</span><span style="color: #BFBDB6"> key</span><span style="color: #BFBDB6B3">,</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #FFB454">get</span><span style="color: #BFBDB6">() {</span></span>
<span class="line"><span style="color: #BFBDB6">        </span><span style="color: #FF8F40">return</span><span style="color: #BFBDB6"> obj[key]</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">      }</span><span style="color: #BFBDB6B3">,</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// This shows an interesting aspect of the logic.</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// This will update the target element everytime</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// something changes.</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #FFB454">set</span><span style="color: #BFBDB6">(</span><span style="color: #D2A6FF">val</span><span style="color: #BFBDB6">) {</span></span>
<span class="line"><span style="color: #BFBDB6">        obj[key] </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> val</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">        </span><span style="color: #FFB454">__updateDOM__</span><span style="color: #BFBDB6">(key)</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">      }</span><span style="color: #BFBDB6B3">,</span></span>
<span class="line"><span style="color: #BFBDB6">    })</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">    </span><span style="color: #ACB6BF8C; font-style: italic">// Think of this as an initial render</span></span>
<span class="line"><span style="color: #BFBDB6">    </span><span style="color: #FFB454">__updateDOM__</span><span style="color: #BFBDB6">(key)</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">  })</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #ACB6BF8C; font-style: italic">// This is an important step otherwise</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #ACB6BF8C; font-style: italic">// everything is useless</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #FF8F40">return</span><span style="color: #BFBDB6"> __refs__</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">}</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"></span></code></pre>
<h1 id="the-updatedom" tabindex="-1">The <code>__updateDOM__()</code></h1>
<p>This is the <a href="https://en.wikipedia.org/wiki/Rosetta_(software)#:~:text=Rosetta%20is%20a%20dynamic%20binary%20translator%20developed,application%20compatibility%20layer%20between%20different%20CPU%20architectures">Rosetta</a> for the <code>reactive</code> DOM Elements and the <code>__refs__</code>. This function is also relative simple in its definition:</p>
<pre class="shiki" style="background-color: #0b0e14"><code><span class="line"><span style="color: #ACB6BF8C; font-style: italic">// Ref can be any key from the __refs__ store</span></span>
<span class="line"><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> </span><span style="color: #FFB454">__updateDOM__</span><span style="color: #BFBDB6"> </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> (</span><span style="color: #D2A6FF">ref</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #ACB6BF8C; font-style: italic">// This is to check whether we want to update a specific ref value</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #FF8F40">if</span><span style="color: #BFBDB6"> (ref) {</span></span>
<span class="line"><span style="color: #BFBDB6">    __reactives__</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// filter out the elements we need</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #F29668">.</span><span style="color: #FFB454">filter</span><span style="color: #BFBDB6">((</span><span style="color: #D2A6FF">reactive</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> reactive</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">dataset</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">ref </span><span style="color: #F29668">===</span><span style="color: #BFBDB6"> ref)</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #F29668">.</span><span style="color: #FFB454">forEach</span><span style="color: #BFBDB6">((</span><span style="color: #D2A6FF">reactive</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">        </span><span style="color: #FF8F40">let</span><span style="color: #BFBDB6"> ref </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> reactive</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">dataset</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">ref</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">        </span><span style="color: #ACB6BF8C; font-style: italic">// Interacting with the DOM</span></span>
<span class="line"><span style="color: #BFBDB6">        </span><span style="color: #ACB6BF8C; font-style: italic">// Nullish coalescing, anybody?</span></span>
<span class="line"><span style="color: #BFBDB6">        reactive</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">textContent </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> __refs__[ref] </span><span style="color: #F29668">??</span><span style="color: #BFBDB6"> </span><span style="color: #AAD94C">&quot;&quot;</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">      })</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">  }</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #ACB6BF8C; font-style: italic">// UPDATE ALL!!</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #FF8F40">else</span></span>
<span class="line"><span style="color: #BFBDB6">    __reactives__</span><span style="color: #F29668">.</span><span style="color: #FFB454">forEach</span><span style="color: #BFBDB6">((</span><span style="color: #D2A6FF">reactive</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #FF8F40">let</span><span style="color: #BFBDB6"> ref </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> reactive</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">dataset</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">ref</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// Interacting with the DOM</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// Nullish coalescing, anybody?</span></span>
<span class="line"><span style="color: #BFBDB6">      reactive</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">textContent </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> __refs__[ref] </span><span style="color: #F29668">??</span><span style="color: #BFBDB6"> </span><span style="color: #AAD94C">&quot;&quot;</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">    })</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">}</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"></span></code></pre>
<h1 id="finding-all-the-reactive-variables-and-bootstrapping-them" tabindex="-1">Finding all the reactive variables and bootstrapping them</h1>
<p>This can be wrapped as an IIFE (Immediately Invoked Function Expression) but I don't consider doing it for the sake of simplicity. So, here we go!!</p>
<pre class="shiki" style="background-color: #0b0e14"><code><span class="line"><span style="color: #ACB6BF8C; font-style: italic">// Get live elements</span></span>
<span class="line"><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> __reactiveEl__ </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> document</span><span style="color: #F29668">.</span><span style="color: #FFB454">querySelectorAll</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;[reactive]&quot;</span><span style="color: #BFBDB6">)</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">__reactiveEl__</span><span style="color: #F29668">.</span><span style="color: #FFB454">forEach</span><span style="color: #BFBDB6">((</span><span style="color: #D2A6FF">el</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #ACB6BF8C; font-style: italic">// Match the `count` between &lt;h1 reactive&gt;${count}&lt;/h1&gt;</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> refs </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> el</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">innerHTML</span><span style="color: #F29668">.</span><span style="color: #FFB454">match</span><span style="color: #BFBDB6">(</span><span style="color: #95E6CB">/\${([</span><span style="color: #F29668">^</span><span style="color: #95E6CB">}]</span><span style="color: #F29668">+</span><span style="color: #95E6CB">)}/</span><span style="color: #FF8F40">g</span><span style="color: #BFBDB6">)</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #ACB6BF8C; font-style: italic">// If the refs exist</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #FF8F40">if</span><span style="color: #BFBDB6"> (refs) {</span></span>
<span class="line"><span style="color: #BFBDB6">    refs</span><span style="color: #F29668">.</span><span style="color: #FFB454">forEach</span><span style="color: #BFBDB6">((</span><span style="color: #D2A6FF">ref</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// extract it</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> dataRef </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> ref</span><span style="color: #F29668">.</span><span style="color: #FFB454">split</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;{&quot;</span><span style="color: #BFBDB6">)[</span><span style="color: #D2A6FF">1</span><span style="color: #BFBDB6">]</span><span style="color: #F29668">.</span><span style="color: #FFB454">split</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;}&quot;</span><span style="color: #BFBDB6">)[</span><span style="color: #D2A6FF">0</span><span style="color: #BFBDB6">]</span><span style="color: #F29668">.</span><span style="color: #FFB454">trim</span><span style="color: #BFBDB6">()</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// insert a special span element with the element</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// and store the key name in the `data-ref` attribute</span></span>
<span class="line"><span style="color: #BFBDB6">      el</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">innerHTML </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> el</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">innerHTML</span><span style="color: #F29668">.</span><span style="color: #FFB454">replace</span><span style="color: #BFBDB6">(</span></span>
<span class="line"><span style="color: #BFBDB6">        ref</span><span style="color: #BFBDB6B3">,</span></span>
<span class="line"><span style="color: #BFBDB6">        </span><span style="color: #AAD94C">`&lt;span class=&quot;reactivity-anywhere&quot; data-ref=&quot;</span><span style="color: #FF8F40">${</span><span style="color: #BFBDB6">dataRef</span><span style="color: #FF8F40">}</span><span style="color: #AAD94C">&quot;&gt;&lt;/span&gt;`</span></span>
<span class="line"><span style="color: #BFBDB6">      )</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">    })</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">    </span><span style="color: #ACB6BF8C; font-style: italic">// Push the span element in __reactives__</span></span>
<span class="line"><span style="color: #BFBDB6">    __reactives__</span><span style="color: #F29668">.</span><span style="color: #FFB454">push</span><span style="color: #BFBDB6">(</span><span style="color: #F29668">...</span><span style="color: #BFBDB6">el</span><span style="color: #F29668">.</span><span style="color: #FFB454">querySelectorAll</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;span.reactivity-anywhere&quot;</span><span style="color: #BFBDB6">))</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">  }</span></span>
<span class="line"><span style="color: #BFBDB6">})</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #ACB6BF8C; font-style: italic">// Initialize all the magic!!</span></span>
<span class="line"><span style="color: #FFB454">__updateDOM__</span><span style="color: #BFBDB6">()</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"></span></code></pre>
<h1 id="making-input-and-textarea-work-with-reactives" tabindex="-1">Making <code>&lt;input&gt;</code> and <code>&lt;textarea&gt;</code> work with reactives</h1>
<p>Of course, we need this if user input is needed for our code to run.</p>
<p>The supercharged textareas and input elements will bear the <code>ref</code> attribute</p>
<p>A lot of things, harsh things are going to be done in this section, so brace yourself and hold on tight.</p>
<pre class="shiki" style="background-color: #0b0e14"><code><span class="line"><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> </span><span style="color: #FFB454">parseDefaultRefValue</span><span style="color: #BFBDB6"> </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> (</span><span style="color: #D2A6FF">el</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #FF8F40">let</span><span style="color: #BFBDB6"> parsed </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> </span><span style="color: #D2A6FF">null</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #FF8F40">try</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">    </span><span style="color: #ACB6BF8C; font-style: italic">// If the passed key is a function, run it</span></span>
<span class="line"><span style="color: #BFBDB6">    </span><span style="color: #ACB6BF8C; font-style: italic">// and store the value</span></span>
<span class="line"><span style="color: #BFBDB6">    </span><span style="color: #ACB6BF8C; font-style: italic">// I&#39;m sorry, but we need to use eval here</span></span>
<span class="line"><span style="color: #BFBDB6">    parsed </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> </span><span style="color: #F07178">eval</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">`(</span><span style="color: #FF8F40">${</span><span style="color: #BFBDB6">el</span><span style="color: #F29668">.</span><span style="color: #FFB454">getAttribute</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;ref-default&quot;</span><span style="color: #BFBDB6">)</span><span style="color: #FF8F40">}</span><span style="color: #AAD94C">)()`</span><span style="color: #BFBDB6">)</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">  } </span><span style="color: #FF8F40">catch</span><span style="color: #BFBDB6"> (e) {</span></span>
<span class="line"><span style="color: #BFBDB6">    parsed </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> el</span><span style="color: #F29668">.</span><span style="color: #FFB454">getAttribute</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;ref-default&quot;</span><span style="color: #BFBDB6">)</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">  }</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #FF8F40">return</span><span style="color: #BFBDB6"> parsed</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">}</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> </span><span style="color: #FFB454">assignDefaultRefsToInputs</span><span style="color: #BFBDB6"> </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> (</span><span style="color: #D2A6FF">el</span><span style="color: #BFBDB6B3">,</span><span style="color: #BFBDB6"> </span><span style="color: #D2A6FF">ref</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">  __refs__[ref] </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> </span><span style="color: #FFB454">parseDefaultRefValue</span><span style="color: #BFBDB6">(el)</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">}</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #ACB6BF8C; font-style: italic">// Select input and textarea elements containing the</span></span>
<span class="line"><span style="color: #ACB6BF8C; font-style: italic">// &#39;ref&#39; attribute, where the attr. value refers to any</span></span>
<span class="line"><span style="color: #ACB6BF8C; font-style: italic">// key in the __refs__ store.</span></span>
<span class="line"><span style="color: #ACB6BF8C; font-style: italic">// The `ref-default` contains the default value for the `ref`</span></span>
<span class="line"><span style="color: #ACB6BF8C; font-style: italic">// eg.</span></span>
<span class="line"><span style="color: #ACB6BF8C; font-style: italic">// &lt;textarea ref=&quot;name&quot;&gt;&lt;/textarea&gt;</span></span>
<span class="line"><span style="color: #BFBDB6">document</span><span style="color: #F29668">.</span><span style="color: #FFB454">querySelectorAll</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;input[ref], textarea[ref]&quot;</span><span style="color: #BFBDB6">)</span><span style="color: #F29668">.</span><span style="color: #FFB454">forEach</span><span style="color: #BFBDB6">((</span><span style="color: #D2A6FF">el</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #ACB6BF8C; font-style: italic">// Keep a ref to the ref!! Because we don&#39;t want to</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #ACB6BF8C; font-style: italic">// lose it in event listeners</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> ref </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> el</span><span style="color: #F29668">.</span><span style="color: #FFB454">getAttribute</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;ref&quot;</span><span style="color: #BFBDB6">)</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">  </span><span style="color: #FF8F40">if</span><span style="color: #BFBDB6"> (ref) {</span></span>
<span class="line"><span style="color: #BFBDB6">    </span><span style="color: #ACB6BF8C; font-style: italic">// lazily update default values</span></span>
<span class="line"><span style="color: #BFBDB6">    window</span><span style="color: #F29668">.</span><span style="color: #FFB454">addEventListener</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;load&quot;</span><span style="color: #BFBDB6B3">,</span><span style="color: #BFBDB6"> () </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> </span><span style="color: #FFB454">assignDefaultRefsToInputs</span><span style="color: #BFBDB6">(el</span><span style="color: #BFBDB6B3">,</span><span style="color: #BFBDB6"> ref))</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">    el</span><span style="color: #F29668">.</span><span style="color: #FFB454">addEventListener</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;input&quot;</span><span style="color: #BFBDB6B3">,</span><span style="color: #BFBDB6"> () </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> {</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// again, a dumb reference to the ref</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> elRef </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> ref</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// preserve default value</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #FF8F40">const</span><span style="color: #BFBDB6"> defaultVal </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> </span><span style="color: #FFB454">parseDefaultRefValue</span><span style="color: #BFBDB6">(el)</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// Set whatever value is typed as the ref value</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #ACB6BF8C; font-style: italic">// else, the default value</span></span>
<span class="line"><span style="color: #BFBDB6">      __refs__[elRef] </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> el</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">value </span><span style="color: #F29668">!==</span><span style="color: #BFBDB6"> </span><span style="color: #AAD94C">&quot;&quot;</span><span style="color: #BFBDB6"> </span><span style="color: #F29668">?</span><span style="color: #BFBDB6"> el</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">value </span><span style="color: #F29668">:</span><span style="color: #BFBDB6"> defaultVal</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">      </span><span style="color: #FF8F40">if</span><span style="color: #BFBDB6"> (__refs__[elRef] </span><span style="color: #F29668">!==</span><span style="color: #BFBDB6"> defaultVal) {</span></span>
<span class="line"><span style="color: #BFBDB6">        </span><span style="color: #ACB6BF8C; font-style: italic">// Keep rest of the input/textarea elements in sync</span></span>
<span class="line"><span style="color: #BFBDB6">        </span><span style="color: #39BAE6">Array</span><span style="color: #F29668">.</span><span style="color: #FFB454">from</span><span style="color: #BFBDB6">(document</span><span style="color: #F29668">.</span><span style="color: #FFB454">querySelectorAll</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;input[ref], textarea[ref]&quot;</span><span style="color: #BFBDB6">))</span></span>
<span class="line"><span style="color: #BFBDB6">          </span><span style="color: #ACB6BF8C; font-style: italic">// Find input/textareas with same refs</span></span>
<span class="line"><span style="color: #BFBDB6">          </span><span style="color: #F29668">.</span><span style="color: #FFB454">filter</span><span style="color: #BFBDB6">((</span><span style="color: #D2A6FF">el</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> el</span><span style="color: #F29668">.</span><span style="color: #FFB454">getAttribute</span><span style="color: #BFBDB6">(</span><span style="color: #AAD94C">&quot;ref&quot;</span><span style="color: #BFBDB6">) </span><span style="color: #F29668">===</span><span style="color: #BFBDB6"> elRef)</span></span>
<span class="line"><span style="color: #BFBDB6">          </span><span style="color: #ACB6BF8C; font-style: italic">// Keep their value in sync</span></span>
<span class="line"><span style="color: #BFBDB6">          </span><span style="color: #F29668">.</span><span style="color: #FFB454">forEach</span><span style="color: #BFBDB6">((</span><span style="color: #D2A6FF">el</span><span style="color: #BFBDB6">) </span><span style="color: #FF8F40">=&gt;</span><span style="color: #BFBDB6"> (el</span><span style="color: #F29668">.</span><span style="color: #BFBDB6">value </span><span style="color: #F29668">=</span><span style="color: #BFBDB6"> __refs__[elRef]))</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">      }</span></span>
<span class="line"><span style="color: #BFBDB6">    })</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"><span style="color: #BFBDB6">  }</span></span>
<span class="line"><span style="color: #BFBDB6">})</span><span style="color: #BFBDB6B3">;</span></span>
<span class="line"></span></code></pre>
<h1 id="were-almost-done" tabindex="-1">We're almost done!</h1>
<p>Now the only thing that remains is to write some HTML to check whether everything works!
So, here we go!!
Some more things to note here:</p>
<ul>
<li>You can use multiple stores!! However, if you redeclare a key in the latter store, it will take precedence, not the first one</li>
</ul>
<!-- <Codepen slug="wvWbNqo" title="Reactivity Anywhere!!" result="result" height="500"/> -->
<h1 id="why-something-like-this-would-be-great-to-use-according-to-me" tabindex="-1">Why something like this would be great to use (according to me)</h1>
<ul>
<li>It will allow HTML to do its work and JS to do its own. It's not like &quot;All HTML!&quot; or &quot;All JS!&quot; but harmony between the two (not to mention CSS here) that will appreciate the job these languages have to do.</li>
<li>Minimal overhead. As I said earlier, no virtual DOM, only real DOM (credits to <a href="https://svelte.dev">Svelte</a>) with some objects in memory</li>
</ul>
<h1 id="limitations" tabindex="-1">Limitations</h1>
<p>You're going to think over this :) because this is just a crude implementation of an idea. So, feel free to critically think over it.</p>
<h1 id="ending-notes" tabindex="-1">Ending notes</h1>
<p>If you seem to be interested in creating some sort of framework with this, you're ready to go (some frameworks, using this idea, might even exist)! I'd also be happy to help you! Thank you for bearing with me in such a long post!</p>

  </div>
  <footer>
    <hr>
    <h2>Webmentions</h2>
<section class="webmention webmention-reactions">
    <p>
        My site uses <a href="http://indieweb.org/webmention">Webmentions</a> via the 
        <a href="https://indieweb.org">Indieweb</a>
        and <a href="https://webmention.io">webmention.io</a> 
        for likes, reposts, and replies/comments.
    </p>
    <form class="send-webmention" action="https://webmention.io/karawale.in/webmention" method="post">
        <label for="webmention-form-input">
             URL of your webmention
        </label>
        <input 
            id="webmention-form-input"
            name="source" type="url" 
            required placeholder="https://example.com/">
        <input 
            type="text"
            name="target"
            hidden value="https://karawale.in/posts/reactivity-anywhere-without-virtual-dom/"
        >
        <input type="submit" value="Send webmention">
    </form>
    <details>
        <summary>
            Likes and reposts
        </summary>
        <ul class="webmention-reactions">
    
        
    
        
    
</ul>
    </details>
    <h3>Replies</h3>
    <ul class="webmention-reactions">
    
        
    
        
    
</ul>
</section>
<section class="webmention-replies"></section>
  </footer>
</article>
</main>
<hr>
<footer>
  <nav>
    <dl>
      
        <dt>Main</dt>
        <dd>
          <ul>
            
              <li>
                <a href="/">Home</a>
              </li>
            
              <li>
                <a href="/contact">Contact</a>
              </li>
            
              <li>
                <a href="/projects">Projects</a>
              </li>
            
              <li>
                <a href="/feed.xml">RSS</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>Writings</dt>
        <dd>
          <ul>
            
              <li>
                <a href="/posts">Blog</a>
              </li>
            
              <li>
                <a href="/notes">Notes</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>Links</dt>
        <dd>
          <ul>
            
              <li>
                <a href="https://sr.ht/~retronav">Sourcehut</a>
              </li>
            
              <li>
                <a href="https://github.com/retronav">GitHub</a>
              </li>
            
              <li>
                <a href="https://www.linkedin.com/in/pranav-karawale">LinkedIn</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  </nav>
</footer>
  </body>
</html>