<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="This post discusses some steps to keep a Firebase project safe and secure."/>

<link rel="me" href="https://github.com/retronav"/>
<link rel="me" href="https://fosstodon.org/@retronav"/>


    <link rel="webmention" href="https://webmention.io/karawale.in/webmention"/>



    <link rel="pingback" href="https://webmention.io/karawale.in/xmlrpc"/>

        <link rel="preload" as="font" type="font/woff2" href="fonts/cabin-latin-variable-wghtOnly-normal.woff2" crossorigin="anonymous">
        <link rel="preload" as="font" type="font/woff2" href="fonts/victor-mono-latin.woff2" crossorigin="anonymous"><meta name="generator" content="Eleventy"/>

<link rel="shortcut icon" href="/favicon.png" type="image/png">
<link rel="stylesheet" href="/main.css"/>
<title>
    
        How to Keep Your Firebase Project Safe and Secure from everyone - Pranav Karawale
    
</title>

<!-- Umami -->
<script
    async
    defer
    data-website-id="9532279e-98ca-4434-b5cb-95d663716f5b"
    src="https://umami.karawale.in/binoculars.js"></script>

  </head>
  <body>
    
<header>
    <img src="/logo96.webp" height="48" width="48" alt="">
    <br/>
    <div class="h-card">
        <a class="u-url p-name" href="/">Pranav Karawale</a>
    </div>
</header>
<hr>
<main>
  <article class="h-entry">
  <header>
    <h1 class="p-name" class="title">How to Keep Your Firebase Project Safe and Secure from everyone</h1>
    <time class="dt-published" datetime="2020-12-18T00:00:00Z">
      18 December 2020
    </time>
    <span class="seperator">&centerdot;</span>
    <span>By</span><div class="h-card h-card-mini p-author">
    <img class="u-photo" width="24" height="24" src="/img/me96.webp" alt="A close-up photo of my face.">
    <a href="/" rel="author" class="p-name u-url">
        Pranav Karawale
    </a>
</div>
    <br>
    <span>Tagged under: </span>
    
      <a class="p-category" href="/tags/posts">posts</a>
    
      <a class="p-category" href="/tags/firebase">firebase</a>
    
      <a class="p-category" href="/tags/security">security</a>
    
      <a class="p-category" href="/tags/webdev">webdev</a>
    
      <a class="p-category" href="/tags/opensource">opensource</a>
    
  </header>
  <aside>
    <nav class="toc" >
        <ul><li><a href="#why-is-this-necessary">Why is this necessary?</a></li><li><a href="#protecting-your-project">Protecting your project</a><ul><li><a href="#firestore-datastore-and-firebase-storage">Firestore datastore and Firebase Storage</a><ul><li><a href="#start-in-production-mode">&quot;Start in production mode&quot;</a></li><li><a href="#configure-security-rules">Configure security rules</a></li><li><a href="#use-seperate-api-keys-if-they-are-used-only-for-one-purpose">Use seperate API keys if they are used only for one purpose</a></li><li><a href="#if-you-need-to-have-your-api-keys-in-your-repo">If you need to have your API keys in your repo</a></li><li><a href="#respect-firebase-server-credentials">Respect Firebase server credentials</a></li></ul></li></ul></li><li><a href="#ending-thoughts">Ending thoughts</a></li></ul>
      </nav>
  </aside>
  <hr/>
  <div class="e-content">
    <p>After doing a couple of open source Firebase projects (web apps, I mean), I feel
like I'm experienced* enough to write this post. So if I say something wrong
here, kindly let me know here.</p>
<h2 id="why-is-this-necessary">Why is this necessary?</h2>
<p>I have a secret here(not really, just some people don't know about it). <strong>Your
Firebase config</strong>, which you might have been wondering where to hide, <strong>is
publicly visible</strong>(if you use Firebase hosting). Don't believe me? Go to the
index page any site which uses Firebase hosting, and just append
"/__/firebase/init.js" (eg. <code>someapp.web.app/__/firebase/init.js</code>) and visit
it, and you'll remain surprised by the result. This is something which is not
discovered by me, its actually written in the
<a href="https://firebase.google.com/docs/hosting/reserved-urls">documentation</a>.</p>
<h2 id="protecting-your-project">Protecting your project</h2>
<h3 id="firestore-datastore-and-firebase-storage">Firestore datastore and Firebase Storage</h3>
<p>This is perhaps the most important part of your backend which possibly contains
sensitive data, which must be protected and it might cause harm when in the
hands of bad people. So how to protect these? Well, here are some steps:</p>
<h4 id="start-in-production-mode">"Start in production mode"</h4>
<p>When setting up Firestore and storage, you might get asked whether to start the
resource in production mode or test mode. So always choose "Production mode" /
"Locked mode". The reason is that this mode introduces some security rules that
will block access from every client. Don't fear though, we can still change
them.</p>
<h4 id="configure-security-rules">Configure <a href="https://firebase.google.com/docs/rules">security rules</a></h4>
<p>Security rules are very great to have. Using these, you can decide who can have
access to data and who cannot. These are written in .rules files and have a
similar syntax to JavaScript which can be understood in the docs. Since we used
production mode, you will see this particular rule in your security rules:</p>
<pre class="shiki" style="background-color: #0b0e14"><code><span class="line"><span style="color: #bfbdb6">match /{document=**} {</span></span>
<span class="line"><span style="color: #bfbdb6">    allow read, write: if false;</span></span>
<span class="line"><span style="color: #bfbdb6">}</span></span>
<span class="line"><span style="color: #bfbdb6">//Don't remove this rule, or else your project is gone</span></span>
<span class="line"><span style="color: #bfbdb6">//and keep this rule at end (this comment is added by me)</span></span>
<span class="line"><span style="color: #bfbdb6"></span></span></code></pre>
<p>Which literally means that no client can access your database and storage, which
is sometimes not needed. So we can introduce changes in how we store data. If
you've used Firebase, you know that for every user that signs up for your app,
they are assigned a unique ID (or UID). We can store resources based on their
UID, for example, in a todo app, one can store user's data in their database at
path <code>/todos/users-uid</code> which makes sense. So in this, we can add a new rule:</p>
<pre class="shiki" style="background-color: #0b0e14"><code><span class="line"><span style="color: #bfbdb6">match /todos/{uid=\*\*} {</span></span>
<span class="line"><span style="color: #bfbdb6">allow read, write: if request.auth != null and request.auth.uid == uid;</span></span>
<span class="line"><span style="color: #bfbdb6">}</span></span>
<span class="line"><span style="color: #bfbdb6"></span></span></code></pre>
<p>This means that if anyone accesses any path under todos collection, they should
be authenticated to the app, and if they try to access a specific UID in the
collection, the database will only allow access if they access data under their
UID. Do the same for Firebase storage as well.</p>
<h4 id="use-seperate-api-keys-if-they-are-used-only-for-one-purpose">Use seperate API keys if they are used only for one purpose</h4>
<p>Suppose you are also developing a CLI for your app (<a href="https://github.com/obnoxiousnerd/lookahead">which I am
doing</a>), you might need your API key
for refreshig the user's JWT (which I am doing :) ). So just don't use the same
Firebase config API key, create a new one which has only access to the things we
need, in this case, we need access to the Token Service API. So you can move to
the <a href="https://console.developers.google.com/">Google APIs dashboard</a>, and then
select your preferred project.</p>
<ol>
<li>
<p>When you're in the dashboard, go to the 'Credentials' section.</p>
<p><img src="https://i.imgur.com/uocb2U3.png" alt=""></p>
</li>
<li>
<p>Then in the top app bar, click the "Create Credentials" button. A drop down
will appear. Select "API key"</p>
</li>
<li>
<p>Then it will show a dialog like this:</p>
<p><img src="https://i.imgur.com/os9Ptgt.png" alt=""></p>
</li>
<li>
<p>Then that key will appear in the "Keys" section. Then, in that list, find the
API key we just created, and then click on the pencil icon.</p>
</li>
<li>
<p>Scroll down and you'll find a section "API restrictions". Select the option
"Restrict key".</p>
</li>
<li>
<p>Then a dropdown will appear with text "Select APIs". Then select the services
which you want the API key to be working with. I'll select the Token Service
API here.</p>
<p><img src="https://i.imgur.com/DOWZTMi.png" alt=""></p>
</li>
<li>
<p>Just hit the "Save" button.</p>
</li>
</ol>
<p>Then in the keys' section, you'll find that the API key has a green check on it.
It means that it is now secure and you'll bear less damage if it got leaked.</p>
<h4 id="if-you-need-to-have-your-api-keys-in-your-repo">If you need to have your API keys in your repo</h4>
<p>If your code is public, and you need your API keys for testing or just to keep
everything modular and smooth, encrypt it and then save it. I also use a similar
approach in my CLI app, beacuse I need it for CI. You can use any encryption
method which uses public-private key pair and then store the encrypted file in
your repo and then decrypt it whenever needed.</p>
<h4 id="respect-firebase-server-credentials">Respect Firebase server credentials</h4>
<p>Now this is important. We've been talking about the general Firebase config
which we add in our web apps, but now, I'm talking about server credentials,
which are used by the Admin SDKs. These are allowed access everywhere; no one
can deny them. So treat them with respect and keep them as a secret only, don't
show them off or else you're done.</p>
<h2 id="ending-thoughts">Ending thoughts</h2>
<p>Good job if you've made it this far. Now you can just chill back and write some
code for your project. Always tell me if you got stuck in any of the steps. Have
a nice day :)</p>
  </div>
  <footer>
    <hr>
    <h2>Webmentions</h2>
<section class="webmention webmention-reactions">
    <p>
        My site uses <a href="http://indieweb.org/webmention">Webmentions</a> via the 
        <a href="https://indieweb.org">Indieweb</a>
        and <a href="https://webmention.io">webmention.io</a> 
        for likes, reposts, and replies/comments.
    </p>
    <form class="send-webmention" action="https://webmention.io/karawale.in/webmention" method="post">
        <label for="webmention-form-input">
             URL of your webmention
        </label>
        <input 
            id="webmention-form-input"
            name="source" type="url" 
            required placeholder="https://example.com/">
        <input 
            type="text"
            name="target"
            hidden value="https://karawale.in/posts/how-to-keep-your-firebase-config-safe/"
        >
        <input type="submit" value="Send webmention">
    </form>
    <details>
        <summary>
            Likes and reposts
        </summary>
        <ul class="webmention-reactions">
    
        
    
        
    
        
    
        
    
        
    
        
    
</ul>
    </details>
    <h3>Replies</h3>
    <ul class="webmention-reactions">
    
        
    
        
    
        
    
        
    
        
    
        
    
</ul>
</section>
<section class="webmention-replies"></section>
  </footer>
</article>
</main>
<hr>
<footer>
  <nav>
    <dl>
      
        <dt>Main</dt>
        <dd>
          <ul>
            
              <li>
                <a href="/">Home</a>
              </li>
            
              <li>
                <a href="/contact">Contact</a>
              </li>
            
              <li>
                <a href="/projects">Projects</a>
              </li>
            
              <li>
                <a href="/feed.xml">RSS</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>Writings</dt>
        <dd>
          <ul>
            
              <li>
                <a href="/posts">Blog</a>
              </li>
            
              <li>
                <a href="/notes">Notes</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>Links</dt>
        <dd>
          <ul>
            
              <li>
                <a href="https://sr.ht/~retronav">Sourcehut</a>
              </li>
            
              <li>
                <a href="https://github.com/retronav">GitHub</a>
              </li>
            
              <li>
                <a href="https://www.linkedin.com/in/pranav-karawale">LinkedIn</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  </nav>
</footer>
  </body>
</html>